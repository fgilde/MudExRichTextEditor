export function initializeMudExRichTextEdit(t,i,r){return new n(t,i,r)}class n{elementRef;options;dotnet;quill;constructor(n,t,i){this.elementRef=n;this.dotnet=t;this.create(this.options=i)}create(n){var t={debug:n.debugLevel,modules:{toolbar:n.toolBar},placeholder:n.placeholder,readOnly:n.readOnly,theme:n.theme};if(n.quillElement||this.elementRef){n.modules&&n.modules.length&&n.modules.forEach(i=>{const r=i.jsReference||window,u=i.jsConfigFunction&&r[i.jsConfigFunction]?r[i.jsConfigFunction](t,n,n.quillElement||this.elementRef):i.options;u&&(t.modules={...t.modules,...u})});this.quill=new Quill(n.quillElement||this.elementRef,t);this.__quill=this.__quill||this.quill;n.quillElement.__quill=this.__quill;n.quillElement.quill=this.quill;n.quillElement.mudRichTextEdit=this;n.beforeUpload&&!n.defaultToolHandlerNames?.includes("image")&&this.quill.getModule("toolbar").addHandler("image",()=>{const n=document.createElement("input");n.setAttribute("type","file");n.setAttribute("accept","image/*");n.click();n.onchange=()=>{const t=n.files[0];if(t){const n=new FileReader;n.onload=()=>{const i=n.result,r={data:new Uint8Array(i),fileName:t.name,extension:t.name.includes(".")?t.name.split(".").slice(-1)[0]:"",contentType:t.type,path:"",size:t.size};this.dotnet.invokeMethodAsync("UploadImage",r).then(n=>{const t=this.quill.getSelection();this.quill.insertEmbed(t.index,"image",n)}).catch(n=>console.error(n))};n.readAsArrayBuffer(t)}}});n.beforeUpload&&this.quill.root.addEventListener("paste",n=>{if(n.clipboardData&&n.clipboardData.files&&n.clipboardData.files.length>0){const t=n.clipboardData.files[0];if(t){n.preventDefault();n.stopImmediatePropagation();const i=new FileReader;i.onload=()=>{const r=i.result,n={data:new Uint8Array(r),fileName:t.name,extension:t.name.includes(".")?t.name.split(".").pop():"",contentType:t.type,path:"",size:t.size};this.dotnet.invokeMethodAsync("UploadImage",n).then(t=>{const i=this.quill.getSelection()||{index:this.quill.getLength()};n.contentType.indexOf("image")!==-1?this.quill.insertEmbed(i.index,"image",t):(this.quill.insertText(i.index,n.fileName,"user"),this.quill.setSelection(i.index,n.fileName.length),this.quill.theme.tooltip.edit("link",t),this.quill.theme.tooltip.save())}).catch(n=>console.error(n))};i.readAsArrayBuffer(t)}}},!0);n.defaultToolHandlerNames&&n.defaultToolHandlerNames.forEach(n=>{this.quill.getModule("toolbar").addHandler(n,()=>this.dotnet.invokeMethodAsync("DelegateHandler",n,[...arguments].slice(1)))});this.quill.container.addEventListener("mouseleave",()=>{this.dotnet.invokeMethodAsync("OnMouseLeave")});this.quill.on("text-change",(n,t,i)=>{var r=this.quill.root.innerHTML;this.dotnet.invokeMethodAsync("OnContentChanged",r,i)});this.quill.on("selection-change",(n,t,i)=>{var r=this.quill.root.innerHTML;n===null&&t!==null?this.dotnet.invokeMethodAsync("OnBlur",r,i):n!==null&&t===null&&this.dotnet.invokeMethodAsync("OnFocus",r,i)});if(this.quill&&this.quill.root&&this.quill.root.parentNode){window.addEventListener("resize",this.adjustTooltipPosition.bind(this));this.interval=setInterval(this.adjustTooltipPosition.bind(this),100);const n=new ResizeObserver(n=>{if(n.length>0){var t=n[0].target.getBoundingClientRect().height;this.dotnet.invokeMethodAsync("OnHeightChanged",t)}});n.observe(this.quill.root.parentNode)}this.dotnet.invokeMethodAsync("OnCreated")}}stopRecording(){this.recognition&&(this.recognition.stop(),this.recognition=null)}startRecording(n){if("webkitSpeechRecognition"in window){this.recognition=new webkitSpeechRecognition;n&&(this.recognition.lang=n);this.recognition.continuous=!0;this.recognition.interimResults=!0;let t=!1;return this.recognition.onresult=n=>{let i="";for(let r=n.resultIndex;r<n.results.length;++r)n.results[r].isFinal?(t=!0,i+=n.results[r][0].transcript+"\n"):i+=n.results[r][0].transcript;let r=this.quill.getSelection()?this.quill.getSelection().index:this.quill.getLength();t&&(this.quill.insertText(r,i,"user"),this.quill.setSelection(r+i.length),t=!1)},this.recognition.start(),!0}return!1}adjustTooltipPosition(){var n=window.getComputedStyle(this.quill.root.parentNode).getPropertyValue("resize");n&&n!=="none"&&(this.adjustPos(this.elementRef.querySelector(".ql-tooltip")),this.adjustPos(this.elementRef.querySelector(".ql-cell-properties-form")),this.adjustPos(this.elementRef.querySelector(".ql-table-properties-form")))}adjustPos(n){if(n&&!n.dataset.mouseIsDown){const i=window.getComputedStyle(n),t=i.position;if(t==="absolute"||t==="fixed"){const t=n.parentElement;if(t){const i=t.getBoundingClientRect(),r=n.getBoundingClientRect();(r.left<i.left||r.top<i.top||r.right>i.right||r.bottom>i.bottom)&&(n.style.left="0")}}n.dataset.dragAttached||(n.dataset.dragAttached="true",n.addEventListener("mousedown",function(t){function f(t){let i=t.clientX-a,r=t.clientY-v;if(n.parentElement){const t=n.parentElement.getBoundingClientRect(),u=n.getBoundingClientRect(),f=u.width,e=u.height;i<0&&(i=0);r<0&&(r=0);i+f>t.width&&(i=t.width-f);r+e>t.height&&(r=t.height-e)}n.style.left=i+"px";n.style.top=r+"px"}function e(){n.dataset.mouseIsDown=!1;document.removeEventListener("mousemove",f);document.removeEventListener("mouseup",e)}const o=window.getComputedStyle(n),i=o.resize,u=10;let r=!1;if(i!=="none"&&((i==="both"||i==="horizontal")&&t.offsetX>n.offsetWidth-u&&(r=!0),(i==="both"||i==="vertical")&&t.offsetY>n.offsetHeight-u&&(r=!0)),!r){n.dataset.mouseIsDown=!0;t.preventDefault();const s=t.clientX,h=t.clientY,c=parseInt(window.getComputedStyle(n).left,10)||0,l=parseInt(window.getComputedStyle(n).top,10)||0,a=s-c,v=h-l;document.addEventListener("mousemove",f);document.addEventListener("mouseup",e)}}))}}insertImage(n){var i=Quill.import("delta"),t=0;return this.quill.getSelection()!==null&&(t=this.quill.getSelection().index),this.quill.updateContents((new i).retain(t).insert({image:n},{alt:n}))}insertMarkup(n){let t=this.quill.getSelection()?.index??this.quill.getLength();this.quill.clipboard.dangerouslyPasteHTML(t,n);this.quill.setSelection(t+n.length)}dispose(){clearInterval(this.interval);this.stopRecording()}}window.MudExRichTextEdit=n;